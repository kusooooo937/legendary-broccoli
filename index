<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å­¦æ ¡ã§äººæ°—ã«ãªã‚ŠãŸã„ãƒšãƒ¼ã‚¸ ğŸŒŸ</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f1724; --accent:#ffb86b; --muted:#9aa7bf;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(255,184,107,0.06), transparent 10%),
    radial-gradient(1000px 500px at 90% 90%, rgba(102,204,255,0.03), transparent 10%), var(--bg);
    color:#eaf2ff;}
  .wrap{max-width:920px;margin:24px auto;padding:20px;}
  header{display:flex;gap:12px;align-items:center}
  .avatar{
    width:88px;height:88px;border-radius:18px;background:linear-gradient(135deg,var(--accent),#ff7ab6);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:#0b1220;font-size:28px;box-shadow:0 6px 18px rgba(0,0,0,0.6);
  }
  h1{margin:0;font-size:20px}
  p.lead{margin:6px 0 0;color:var(--muted)}
  main{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:18px}
  .card{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,0.02));padding:14px;border-radius:12px;backdrop-filter:blur(4px);box-shadow:0 6px 22px rgba(2,6,23,0.6)}
  .big{font-size:18px;margin:6px 0 12px}
  .btn{display:inline-block;padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#ff7ab6);color:#07101b;font-weight:700;text-decoration:none;cursor:pointer;border:none}
  .muted{color:var(--muted);font-size:13px}
  /* Poll */
  .choices{display:flex;flex-direction:column;gap:8px}
  .choice{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;background:var(--glass)}
  .choice button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;color:var(--muted);cursor:pointer}
  .bar{height:10px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden;margin-top:6px}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ff7ab6)}
  /* Compliment */
  .compliment{font-weight:700;font-size:16px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  /* Reactions */
  .reactions{display:flex;gap:8px}
  .react{padding:8px;border-radius:10px;background:var(--glass);cursor:pointer;font-weight:700}
  /* Guestbook */
  textarea{width:100%;min-height:68px;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit}
  .entry{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  @media (max-width:920px){main{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="avatar" id="avatar">ã„ã‹</div>
    <div>
      <h1 id="displayName">ã„ã‹ã—ãƒ¼ â€” ã‚¯ãƒ©ã‚¹ã®äººæ°—è€…ã‚’ç›®æŒ‡ã™</h1>
      <p class="lead">æ¥½ã—ããƒ»å®‰å¿ƒãƒ»ã‚¦ã‚±ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§æ³¨ç›®ã‚’é›†ã‚ã‚ˆã†ï¼ã‚¹ãƒãƒ›ã§è¦‹ã›ã‚‹ã¨åŠ¹æœå¤§ã€‚</p>
    </div>
  </header>

  <main>
    <section>
      <div class="card">
        <div class="big">ğŸ“£ ä»Šã™ãä½¿ãˆã‚‹ã‚¦ã‚±ç‹™ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>

        <div style="display:grid;gap:12px">
          <!-- Poll -->
          <div>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <strong>ğŸ”¥ ä»Šæ—¥ã®ã‚¦ã‚±ã‚‹ãƒã‚¿ã¯ï¼Ÿï¼ˆæŠ•ç¥¨ã—ã¦ã­ï¼‰</strong>
              <button class="btn" id="resetPoll" title="æŠ•ç¥¨ã‚’ãƒªã‚»ãƒƒãƒˆ">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div class="choices" id="pollChoices" style="margin-top:10px">
              <!-- choices populated by JS -->
            </div>
          </div>

          <!-- Compliment generator -->
          <div>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <strong>âœ¨ è¤’ã‚ã“ã¨ã°ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿</strong>
              <button class="btn" id="newCompliment">è¤’ã‚ã¦ï¼</button>
            </div>
            <div class="compliment" id="complimentText" style="margin-top:10px">ã€Œã„ã¤ã‚‚é­…åŠ›çš„ã ã­ï¼ã€</div>
            <div class="muted" style="margin-top:8px">ä½¿ã„ã©ã“ã‚ï¼šã‚«ãƒ¼ãƒ‰ã«æ›¸ã„ã¦æ¸¡ã™ã€ãƒãƒ£ãƒƒãƒˆã§é€ã‚‹ã€æœã®æŒ¨æ‹¶ã«ã€‚</div>
          </div>

          <!-- Guestbook -->
          <div>
            <strong>ğŸ“ ä¼è¨€ãƒ»ã‚²ã‚¹ãƒˆãƒ–ãƒƒã‚¯</strong>
            <div class="muted" style="margin-bottom:8px">åŒ¿åã§ã‚‚OKï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</div>
            <textarea id="guestText" placeholder="ã“ã“ã«ä¸€è¨€ï¼"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="postGuest">æŠ•ç¨¿</button>
              <button class="btn" id="clearGuest" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">å…¨éƒ¨æ¶ˆã™</button>
            </div>
            <div id="guestList" style="margin-top:12px"></div>
          </div>
        </div>
      </div>

      <!-- Reactions / Quick share -->
      <div class="card" style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>ğŸ’¬ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¦ã‚±ã‚’æ¸¬ã‚‹</strong>
          <div class="muted">ã‚¹ãƒãƒ›ã§ã‚¿ãƒƒãƒ—ï¼</div>
        </div>
        <div style="margin-top:10px" class="reactions">
          <div class="react" data-r="ğŸ”¥">ğŸ”¥ <span id="r-fire">0</span></div>
          <div class="react" data-r="ğŸ˜‚">ğŸ˜‚ <span id="r-lol">0</span></div>
          <div class="react" data-r="ğŸ‘">ğŸ‘ <span id="r-like">0</span></div>
          <div class="react" data-r="ğŸ‰">ğŸ‰ <span id="r-party">0</span></div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="shareBtn">ã‚·ã‚§ã‚¢ã™ã‚‹</button>
          <button class="btn" id="copyBtn" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
      </div>

    </section>

    <aside>
      <div class="card">
        <strong>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†</strong>
        <div style="margin-top:8px">
          <input id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã„ã‹ã—ãƒ¼ï¼‰" style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="initials" maxlength="2" placeholder="ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«" style="width:64px;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit" />
            <button class="btn" id="saveProfile">ä¿å­˜</button>
          </div>
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
        <div>
          <strong>æŠ•ç¥¨çµæœã‚µãƒãƒª</strong>
          <div id="pollSummary" style="margin-top:8px" class="muted"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <strong>ãƒ’ãƒ³ãƒˆï¼šå­¦æ ¡ã§ã‚¦ã‚±ã‚‹ã‚³ãƒ„</strong>
        <ul class="muted" style="padding-left:18px;margin-top:8px">
          <li>è‡ªç„¶ä½“ã§ã‚„ã•ã—ã„â€”æŠ¼ã—ã¤ã‘ã¯é€†åŠ¹æœ</li>
          <li>ãƒã‚¿ã¯çŸ­ãã€ã‚¹ãƒãƒ›ã§è¦‹ã›ã‚‰ã‚Œã‚‹å½¢ã«</li>
          <li>ä»–äººã‚’å‚·ã¤ã‘ãªã„ã‚¸ãƒ§ãƒ¼ã‚¯ã‚’é¸ã¶</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer>
    ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ã§ã™ã€‚å¿…è¦ãªã‚‰å…¬é–‹æ–¹æ³•ã‚„SNSé€£æºã‚’æ‰‹ä¼ã†ã‚ˆã€‚  
  </footer>
</div>

<script>
/* ---- åˆæœŸãƒ‡ãƒ¼ã‚¿ ---- */
const choices = [
  {id:'meme', label:'é¢ç™½ãƒŸãƒ¼ãƒ ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆï¼‰', votes:0},
  {id:'trick', label:'ä¸€ç™ºèŠ¸ï¼ˆçŸ­ã„ï¼‰', votes:0},
  {id:'photo', label:'ã‚¯ãƒ¼ãƒ«ãªå†™çœŸãƒ»è‡ªæ’®ã‚Š', votes:0},
  {id:'quiz', label:'ã‚¯ã‚¤ã‚ºãƒ»è¬è§£ã', votes:0}
];

const compliments = [
  "ä»Šæ—¥ã®å›ã€ãªã‚“ã‹è¼ã„ã¦ã‚‹ã‚ˆï¼",
  "ä¸€ç·’ã«ã„ã‚‹ã¨æ¥½ã—ããªã‚‹äººã ã­",
  "ãã®ç¬‘é¡”ã€å‘¨ã‚Šã¾ã§æ˜ã‚‹ãã™ã‚‹ï¼",
  "æ°—é…ã‚ŠãŒã§ãã¦ã‹ã£ã“ã„ã„ã­",
  "ç™ºæƒ³ãŒç‹¬ç‰¹ã§é¢ç™½ã„ï¼",
  "é ¼ã‚Šã«ãªã‚‹é›°å›²æ°—ãŒã‚ã‚‹ã‚ˆ"
];

/* ---- storage helpers ---- */
function save(key, obj){localStorage.setItem(key, JSON.stringify(obj))}
function load(key, fallback){try{const v=localStorage.getItem(key); return v?JSON.parse(v):fallback}catch(e){return fallback}}

/* ---- Poll UI ---- */
function renderPoll(){
  const container = document.getElementById('pollChoices');
  container.innerHTML = '';
  const poll = load('school_poll', choices);
  // ensure we have keys
  poll.forEach(c=>{
    const div = document.createElement('div');
    div.className = 'choice';
    div.innerHTML = `<div style="flex:1">${c.label}</div>
      <div style="display:flex;align-items:center;gap:8px">
        <div class="muted" style="min-width:46px;text-align:right">${c.votes}</div>
        <button data-id="${c.id}">æŠ•ç¥¨</button>
      </div>`;
    container.appendChild(div);
    div.querySelector('button').onclick = ()=>{vote(c.id)}
    const bar = document.createElement('div');
    bar.className='bar';
    const percent = document.createElement('i');
    const total = poll.reduce((s,i)=>s+i.votes,0) || 1;
    percent.style.width = Math.round((c.votes/total)*100) + '%';
    bar.appendChild(percent);
    container.appendChild(bar);
  });
  renderSummary();
}

function vote(id){
  const poll = load('school_poll', choices);
  const item = poll.find(p=>p.id===id);
  if(item) item.votes++;
  save('school_poll', poll);
  renderPoll();
}

/* reset */
document.getElementById('resetPoll').onclick = ()=>{
  if(confirm('æŠ•ç¥¨ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')){
    save('school_poll', choices);
    renderPoll();
  }
}

/* ---- Poll summary ---- */
function renderSummary(){
  const poll = load('school_poll', choices);
  const total = poll.reduce((s,i)=>s+i.votes,0);
  const el = document.getElementById('pollSummary');
  if(total===0) el.textContent = 'ã¾ã æŠ•ç¥¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
  else {
    el.innerHTML = poll.map(p=>`${p.label}: ${p.votes}ç¥¨`).join('<br>');
  }
}

/* ---- Compliment generator ---- */
document.getElementById('newCompliment').onclick = ()=>{
  const i = Math.floor(Math.random()*compliments.length);
  document.getElementById('complimentText').textContent = 'ã€Œ' + compliments[i] + 'ã€';
}

/* ---- Guestbook ---- */
function renderGuests(){
  const list = load('school_guests', []);
  const el = document.getElementById('guestList');
  el.innerHTML = '';
  list.slice().reverse().forEach(item=>{
    const div = document.createElement('div');
    div.className='entry';
    div.innerHTML = `<div style="font-weight:700">${item.name || 'åŒ¿å' } <span class="muted" style="font-weight:400">- ${new Date(item.t).toLocaleString()}</span></div>
      <div style="margin-top:6px">${escapeHtml(item.text)}</div>`;
    el.appendChild(div);
  });
}

document.getElementById('postGuest').onclick = ()=>{
  const txt = document.getElementById('guestText').value.trim();
  if(!txt){alert('ä¸€è¨€å…¥ã‚Œã¦ã­ï¼'); return;}
  const list = load('school_guests', []);
  list.push({name: (document.getElementById('nameInput').value || 'åŒ¿å'), text: txt, t: Date.now()});
  save('school_guests', list);
  document.getElementById('guestText').value='';
  renderGuests();
}
document.getElementById('clearGuest').onclick = ()=>{
  if(confirm('ã‚²ã‚¹ãƒˆãƒ–ãƒƒã‚¯ã‚’å…¨éƒ¨æ¶ˆã™ï¼Ÿ')){ save('school_guests', []); renderGuests(); }
}

/* ---- Reactions ---- */
const reacts = ['r-fire','r-lol','r-like','r-party'];
function loadReacts(){ return load('school_reacts', {fire:0,lol:0,like:0,party:0}) }
function saveReacts(obj){ save('school_reacts', obj); updateReactUI(); }
function updateReactUI(){
  const v = loadReacts();
  document.getElementById('r-fire').textContent = v.fire;
  document.getElementById('r-lol').textContent = v.lol;
  document.getElementById('r-like').textContent = v.like;
  document.getElementById('r-party').textContent = v.party;
}
document.querySelectorAll('.react').forEach(el=>{
  el.onclick = ()=>{
    const key = el.dataset.r;
    const v = loadReacts();
    if(key==='ğŸ”¥') v.fire++;
    else if(key==='ğŸ˜‚') v.lol++;
    else if(key==='ğŸ‘') v.like++;
    else if(key==='ğŸ‰') v.party++;
    saveReacts(v);
    // small visual feedback
    el.animate([{transform:'scale(1)'},{transform:'scale(1.12)'},{transform:'scale(1)'}],{duration:180});
  }
});

/* ---- Profile save ---- */
document.getElementById('saveProfile').onclick = ()=>{
  const name = document.getElementById('nameInput').value.trim() || 'ã„ã‹ã—ãƒ¼';
  const initials = document.getElementById('initials').value.trim().slice(0,2) || name.slice(0,2);
  save('school_profile', {name,initials});
  applyProfile();
}
function applyProfile(){
  const p = load('school_profile', {name:'ã„ã‹ã—ãƒ¼',initials:'ã„ã‹'});
  document.getElementById('displayName').textContent = `${p.name} â€” ã‚¯ãƒ©ã‚¹ã®äººæ°—è€…ã‚’ç›®æŒ‡ã™`;
  document.getElementById('avatar').textContent = p.initials;
  document.getElementById('nameInput').value = p.name;
  document.getElementById('initials').value = p.initials;
}

/* ---- Share / copy ---- */
document.getElementById('shareBtn').onclick = async ()=>{
  const text = `${document.getElementById('displayName').textContent}\nãŠã™ã™ã‚ãƒã‚¿ã‚’æŠ•ç¥¨ã—ã¦ã­ï¼`;
  if(navigator.share){ try{ await navigator.share({title:'æ³¨ç›®ãƒšãƒ¼ã‚¸',text}); } catch(e){} }
  else { alert('ã“ã®ç«¯æœ«ã§ã¯å…±æœ‰æ©Ÿèƒ½ãŒä½¿ãˆã¾ã›ã‚“ã€‚ã‚³ãƒ”ãƒ¼ã§å…±æœ‰ã—ã¦ã­ã€‚'); navigator.clipboard.writeText(text).then(()=>alert('å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'))}
}
document.getElementById('copyBtn').onclick = ()=>{
  const summary = `${document.getElementById('displayName').textContent}\n${document.getElementById('pollSummary').innerText}\n${document.getElementById('complimentText').innerText}`;
  navigator.clipboard.writeText(summary).then(()=>{ alert('å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼') });
}

/* ---- helpers ---- */
function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;') }

/* ---- init ---- */
(function init(){
  // ensure poll exists in storage
  if(!localStorage.getItem('school_poll')) save('school_poll', choices);
  if(!localStorage.getItem('school_reacts')) save('school_reacts', {fire:0,lol:0,like:0,party:0});
  renderPoll();
  renderGuests();
  updateReactUI();
  applyProfile();
})();
</script>
</body>
</html>
